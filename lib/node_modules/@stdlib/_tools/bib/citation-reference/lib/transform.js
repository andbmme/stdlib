/**
* @license Apache-2.0
*
* Copyright (c) 2018 The Stdlib Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*    http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

'use strict';

// MODULES //

var replace = require( '@stdlib/string/replace' );


// VARIABLES //

var SMART_DOUBLE_QUOTES = /[\u201C\u201D\u201E\u201F]/g;
var SMART_SINGLE_QUOTES = /[\u2018\u2019\u201A\u201B]/g;
var ITALIC_START = / \*/g;
var ITALIC_END = /\*([ .])/g;
var BOLD_START = / __/g;
var BOLD_END = /__([ .])/g;
var TMP_START = /{{REPLACE_ITALIC_START}}/g;
var TMP_END = /{{REPLACE_ITALIC_END}}([ .])/g;


// MAIN //

/**
* Transforms raw reference output.
*
* @private
* @param {string} raw - raw output
* @returns {string} transformed output
*
* @example
* var raw = 'Bays, Carter, and S. D. Durham. 1976. “Improving a Poor Random Number Generator.” *ACM Trans. Math. Softw.* 2 (1). New York, NY, USA: ACM: 59–64. doi:[10.1145/355666.355670](http://dx.doi.org/10.1145/355666.355670).';
*
* var out = transform( raw );
* // returns 'Bays, Carter, and S. D. Durham. 1976. "Improving a Poor Random Number Generator." _ACM Trans. Math. Softw._ 2 (1). New York, NY, USA: ACM: 59–64. doi:[10.1145/355666.355670](http://dx.doi.org/10.1145/355666.355670).'
*/
function transform( raw ) {
	raw = replace( raw, SMART_SINGLE_QUOTES, '\'' );
	raw = replace( raw, SMART_DOUBLE_QUOTES, '"' );

	// Replace `*` markers indicating emphasis with a temporary place holder:
	raw = replace( raw, ITALIC_START, '{{REPLACE_ITALIC_START}}' );
	raw = replace( raw, ITALIC_END, '{{REPLACE_ITALIC_END}}$1' );

	// Replace `__` markers indicating strong with `**`:
	raw = replace( raw, BOLD_START, ' **' );
	raw = replace( raw, BOLD_END, '**$1' );

	// Replace temporary place holders with `_` to indicate emphasis:
	raw = replace( raw, TMP_START, ' _' );
	raw = replace( raw, TMP_END, '_$1' );

	return raw;
}


// EXPORTS //

module.exports = transform;
